<% provide(:title, @user.name) %>

<!--modal-->
  <div id="modal-window" class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content"></div>
    </div>
  </div>

<% if @user == current_user %>
<div>
  <%= link_to(edit_user_path) do%>
  <span class='glyphicon glyphicon-pencil'></span><p style="display: inline-block; margin-left: 5px;">edit my profile</p>
  <% end %>
</div>
<% end %>

<div style="position: relative;">
<div id="user_display">
  <section class="user_info">
    <div id="avatarBacking" style="display: inline-block; vertical-align: top;">
      <div class="avatar" style="background-image: url('<%= @user.avatar %>');"></div>
    </div>
    <h1>
      <span style="text-align: left; display: block;"><%= @user.name %></span>
    </h1>
  </section>
<!--
  <div class="stats">
    <%#= render 'shared/stats' %>
    <%#= render 'follow_form' if logged_in? %>
  </div>
-->
</div>

<% if @user.cover_photo? %>
  <div id="coverPhoto" style="background-image: url('<%= @user.cover_photo %>'); background-position: center; background-size: cover;">
  </div>
<% else %>
  <div id="coverPhoto" style="padding-top: 0px; height: <%= @user.cover_photo? ? '100' : '0' %>%;">
  </div>
<% end %>
</div>

<div class="row" >
  <div class='col-md-4 col-sm-12'>
    <%= render :partial => 'shared/accolades', :locals => {:category => @user.category} %>
  </div>
  <div class='col-md-4 col-sm-12'>
    
  </div>
  <div class='col-md-4 col-sm-12'>
    <%= render 'shared/stats' %>
  </div>
</div>

<div id="topTen">

  <% if @products.count > 0 || @user == current_user %>

  <div class="accordion" id="productsContainer">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button class="btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" style="width: 100%;">
          <h4 id="topPicksTitle" style="display: inline-block; width: 100%;">My Top Picks: <span class="glyphicon glyphicon-triangle-bottom" style="float: right;"></span></h4>
          </button>
        </h5>
      </div>

      <div id="collapseOne" class="collapse in" aria-labelledby="headingOne" data-parent="#accordionExample">
        <div class="card-body">
          <%= render @products %>

          <% if @user == current_user %>
            <% if @products.count < 10 %>
              <%=link_to({:controller => "users", :action => "add_product", :user_id => current_user.id, :remote => true, 'data-toggle' =>  "modal", 'data-target' => '#modal-window', class: 'btn btn-primary btn-lg'},) do%>
                <div class="product">
                  <div class="addProduct">
                    <p class="productInnerText"><span class="glyphicon glyphicon-plus"></span></p>
                  </div>
                </div>
                <h6 style="text-align: center; margin-bottom: 30px;">Add up to 10 products</h6>
              <% end %> 
            <% else %>
                <h6>You've reached your limit of 10 products</h6>
            <% end %>
          <% end %>

        </div>
      </div>
    </div>
  </div>

  <% end %>

</div>

<div id="activity">
  <h3>Activity (<%= @events.count %>)</h3>
  <% if @events %>
    <ol id="microPostsContainer" class="microposts micropost-full">
      <%= render @events %>
    </ol>
    <%= will_paginate @events %>
  <% else %>
    <p>No activity.</p>
  <% end %>
</div>

<script>
  function togglePanel (){
     var w = $(window).width();
     if (w <= 768) {
        $('#collapseOne').removeClass('in');
     } else {
        $('#collapseOne').addClass('in');
     }
  }

  $( document ).ready(function() {
    togglePanel();
    
    history.pushState(null, '<%= :title %>', '/users/<%= @user.slug %>');

    var cover = document.getElementById('coverPhoto');
    var coverWidth = $("#coverPhoto").width();
    <% if !@user.cover_photo? %>
      //trianglify
      color_arr = ['#2d4059', '#437F97', '#f6f6f6'];

      shuffleArray(color_arr);

      var pattern = Trianglify({
        width: coverWidth,
        height: coverWidth*0.35,
        cell_size: 75,
        x_colors: color_arr
      });

      cover.appendChild(pattern.canvas());
    <% else %>
      $("#coverPhoto").height(coverWidth * 0.35);
    <% end %>

  });

  function shuffleArray (array){
    for (let i = array.length - 1; i > 0; i--) {
        const rand = Math.floor(Math.random() * (i + 1));
        [array[i], array[rand]] = [array[rand], array[i]];
    }
  }

  show_tooltips();
  
</script>