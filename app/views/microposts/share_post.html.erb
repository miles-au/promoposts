<h1 style="text-align: left;">Share this post:</h1>

<div class="row" style="margin-bottom:10px;">
	<div class="col-md-6 col-sm-12">
		<p><%= @micropost.category.titlecase.tr("_", " ") %></p>
		<img style="max-width: 100%; max-height: 300px;" src="<%= @micropost.picture.url %>" />
	</div>
	<div class="col-md-6 col-sm-12">
		<p><%= @micropost.content %></p>
	</div>
</div>

<%= form_tag(share_post_path(@micropost.id), method: :post, html: { id: "shareContainer" } ) do %>
	<%= label_tag :message, "Post caption:" %>
	<div class="pop-button" style="margin-bottom: 10px;" id="useOriginalText">Use/edit original caption</div>
	<%= text_area_tag :message, nil, :id => "inputText", :maxlength => 240 %>
	
	<%= link_to "Manage Accounts", '/accounts/edit' %>
	<% Account.platform_array.each do |platform| %>
		<%= render :partial => 'accounts_list', locals: { platform: platform }%>
	<% end %>


  	<div>
		<%= submit_tag "Share", class: "pop-button hidden", id: "share-button" %>
		<div id="micropost-missing-fields" class="pop-button pop-button-grey" style="display: block; margin: 5px 0;">Share</div>
		<ul style="text-align: left;">
			<li id="missing-text">Missing text</li>
			<li id="missing-pages">Missing pages to share to</li>
		</ul>
	</div>
<% end %>

<script>
	$('#useOriginalText').click(function() {
	  $( "#inputText" ).val("<%= escape_javascript(raw(@micropost.content)) %>");
	  check_fields();
	});

	$( "input[type='checkbox']" ).change(function() {
	  check_fields();
	});

	$("#inputText").on("change keyup paste", function(){
		check_fields();
	})

	function check_fields(){
		text = document.getElementById("inputText");
		var str_length = text.value.length;

		var checkboxes = document.getElementsByName('pages[]');
		var pageChecked = false;

		for(var i = 0; i < checkboxes.length; i++) {
		    if(checkboxes[i].type.toLowerCase() == 'checkbox') {
		        if(checkboxes[i].checked == true){
		        	pageChecked = true;
		        }
		    }
		}

		if(str_length > 0 && pageChecked == true){
			all_fields();
		}else{
			missing_fields(str_length, pageChecked);
		}
	}

	function missing_fields(str_length, pageChecked){
		if(str_length > 0){
			$('#missing-text').addClass('hidden');
		}else{
			$('#missing-text').removeClass('hidden');
		}

		if(pageChecked){
			$('#missing-pages').addClass('hidden');
		}else{
			$('#missing-pages').removeClass('hidden');
		}

		$('#share-button').addClass('hidden');
		$('#micropost-missing-fields').removeClass('hidden');
	}
	function all_fields(){
		$('#missing-text').addClass('hidden');
		$('#missing-pages').addClass('hidden');
		$('#share-button').removeClass('hidden');
		$('#micropost-missing-fields').addClass('hidden');
	}

</script>