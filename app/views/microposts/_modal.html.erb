<%= form_for @event, url: share_to_socials_path(:id => current_user.id, :micropost_id => @micropost.id), html: {method: :post} do |f| %>
	<div style="margin: 0px; text-align: right;">
		<%= link_to @micropost, :data=> {:current_user_id => current_user.id, :micropost_id => @micropost_id}, :class => "link_to_post" do %>
			<span class="glyphicon glyphicon-link"></span><p>Link to this Post</p>
		<% end %>
		<button type="button" class="close" data-dismiss="modal" ><span class="glyphicon glyphicon-remove"></span></button>
	</div>
	<div class="row">
		<div class="col-md-8 col-sm-12">
			<div class="modal-header">
				<h3 class="modal-title" id="myModalLabel">1. Edit your text</h3>
			</div>
			<div class="modal-body">
			  <div class="micropost-modal">
				  <div class="section">
				      <span class="content">
				      	<%= f.text_field :message, :id => "inputText" %>
				      	<div class="btn" id="useOriginalText">Use/Edit Original Text</div>
				      	<p><%= @micropost.content %></p>
				        <% if @micropost.picture? %>
				        	<img src="<%= @micropost.picture.url %>", alt="promo post picture" />
				        <% end %>
				      </span>
				  </div>
				</div>
			</div>
		</div>
		<div class="col-md-4 col-sm-12">
			<div class="modal-header">
				<h3 class="modal-title" id="myModalLabel">2. Share it!</h3>
			</div>
			<div id="shareContainer">
			    <% if current_user %>
			    	<span class="SoMeIcon">
			    		<img class="facebook-login" src="<%= ActionController::Base.helpers.asset_path('facebook.svg')%>">
			    	</span>
			    	<% if !@fbaccounts.empty? %>
						<% @fbaccounts.each do |page| %>
							<%= render(:partial => 'page_display', :locals => { :page_name => page.name, :page_id => page.account_id, :page_picture => page.picture}) %>
						<% end %>
					<% else %>
						<% if current_user.fb_uid %>
							<h6>No sharable pages available.</h6>
						<% else %>
							<%= render(:partial => 'shared/connect_account', :locals => { :provider => 'facebook'}) %>
						<% end %>
					<% end %>
					<span class="SoMeIcon">
			    		<img class="linkedin-login" src="<%= ActionController::Base.helpers.asset_path('linkedin.svg')%>">
			    	</span>
			    	<% if !@linkedinaccounts.empty? %>
						<% @linkedinaccounts.each do |page| %>
							<%= render(:partial => 'page_display', :locals => { :page_name => page.name, :page_id => page.account_id, :page_picture => page.picture}) %>
						<% end %>
					<% else %>
						<% if current_user.linkedin_uid %>
							<h6>No sharable pages available.</h6>
						<% else %>
							<%= render(:partial => 'shared/connect_account', :locals => { :provider => 'linkedin'}) %>
						<% end %>
					<% end %>
					<span class="SoMeIcon">
			    		<img class="buffer-login" src="<%= ActionController::Base.helpers.asset_path('buffer.svg')%>">
			    	</span>
					<% if !@bufferaccounts.empty? %>
						<% @bufferaccounts.each do |page| %>
							<%= render(:partial => 'page_display', :locals => { :page_name => page.name, :page_id => page.account_id, :page_picture => page.picture}) %>
						<% end %>
					<% else %>
						<% if current_user.buffer_uid %>
							<h6>No sharable pages available.</h6>
						<% else %>
							<%= render(:partial => 'shared/connect_account', :locals => { :provider => 'buffer'}) %>
						<% end %>
					<% end %>

			    <% else %>
			      <%= link_to( "Please log in to share posts", login_path) %>
			    <% end %>
			  </div>
			  <div class="modal-footer">
				<%= f.submit "Share", class: "btn btn-primary hidden", id: "share-button" %>
				<div id="micropost-missing-fields" class="" style="display: block; margin: 5px 0;">Share</div>
				<ul style="text-align: left;">
					<li id="missing-text">Missing text</li>
					<li id="missing-pages">Missing pages to share to</li>
				</ul>
			</div>
		</div>
		<div class="col-md-1">
			
		</div>
	</div>
<% end %>

<script>
	$('#useOriginalText').click(function() {
	  $( "#inputText" ).val("<%= @micropost.content %>");
	  check_fields();
	});

	$("#inputText").on("change keyup paste", function(){
		check_fields();
	})

	$("#product_link").on("change keyup paste", function(){
		check_fields();
	})

	function check_fields(){
		text = document.getElementById("inputText");
		var str_length = text.value.length;

		var checkboxes = document.getElementsByName('event[pages][]');
		var pageChecked = false;

		for(var i = 0; i < checkboxes.length; i++) {
		    if(checkboxes[i].type.toLowerCase() == 'checkbox') {
		        if(checkboxes[i].checked == true){
		        	pageChecked = true;
		        }
		    }
		}

		if(str_length > 0 && pageChecked == true){
			all_fields();
		}else{
			missing_fields(str_length, pageChecked);
		}
	}

	function missing_fields(str_length, pageChecked){
		if(str_length > 0){
			$('#missing-text').addClass('hidden');
		}else{
			$('#missing-text').removeClass('hidden');
		}

		if(pageChecked){
			$('#missing-pages').addClass('hidden');
		}else{
			$('#missing-pages').removeClass('hidden');
		}

		$('#share-button').addClass('hidden');
		$('#micropost-missing-fields').removeClass('hidden');
	}
	function all_fields(){
		$('#missing-text').addClass('hidden');
		$('#missing-pages').addClass('hidden');
		$('#share-button').removeClass('hidden');
		$('#micropost-missing-fields').addClass('hidden');
	}

</script>
